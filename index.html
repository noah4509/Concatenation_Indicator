<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="trello-power-up-allowed-origins" content="https://trello.com">
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
  </head>
  <body>
    <script>
      window.TrelloPowerUp.initialize({
        'card-badges': function(t, options) {
          return t.card('customFieldItems')
            .then(function(card) {
              // Find the % COMPLETE custom field
              const progressField = card.customFieldItems.find(field => 
                field.name && field.name.toLowerCase().includes('complete'));
              
              const progress = progressField ? progressField.value.number : 0;
              
              return [{
                icon: 'https://raw.githubusercontent.com/noah4509/Concatenation_Indicator/main/load.png',
                text: progress + '%',
                color: progress === 100 ? 'green' : 'blue'
              }];
            });
        },
        'card-detail-badges': function(t, options) {
          return t.card('customFieldItems')
            .then(function(card) {
              // Find the % COMPLETE custom field
              const progressField = card.customFieldItems.find(field => 
                field.name && field.name.toLowerCase().includes('complete'));
              
              const progress = progressField ? progressField.value.number : 0;
              
              return [{
                title: 'Progress',
                text: progress + '%',
                color: progress === 100 ? 'green' : 'blue',
                callback: function(t) {
                  return t.popup({
                    title: 'Update Progress',
                    url: './progress.html',
                    height: 120
                  });
                }
              }];
            });
        }
      });
    </script>
  </body>
</html>
